# Code snippets
Just general code snippets I find useful in an engagement but hard to remember :)


### ssh socks4/socks5 forwarding
` # ssh -D 1081 [remote server] `

### configure tsocks for ssh socks
- change "server = 192.xx.xx.xx" to localhost in /etc/tsocks.conf
- change "server_type = 5" to 4, same file.


### Apt through proxy
Especially useful if don't have tsocks in stalled.
- Set up your SSH proxy
    - ` # ssh -D 1081 [ip] `
- Set up apt 12proxy file:
    - ` # echo 'Acuire::http::proxy "socks5h://127.0.0.1:1081";' > /etc/apt/apt.conf.d/12proxy `
- Keep using it this way if all you need it apt, or install and use tsocks for pip/other stuff.
- Possible port conflict: ntlmrelayx with socks or other tools using 1081.

### Apt or pip through tsocks
1. Must have ssh socks4/socks5 forwarding
2. tsocks msut be configured

- ` # tsocks apt install whatever `
- OR
- ` #. tsocks on `
- ` # apt install whatever `
- ` # pip install stuff `
- ` #. tsocks off `

- If you have SSL issues you may need to append to your pip command: 
    - `--proxy socks4:127.0.0.1:1081 --trusted-host pypi.org --trusted-host files.pythonhosted.org`

### Add service to systemd
- Copy local file:
` sudo cp file.service /etc/systemd/system `
- Start service
` sudo systemctl start file.servce `
- Enable service for future boots
` sudo systemctl enable file.service `

### Clone SYSVOL
- Mount dir:
` mkdir /smbclient `
` mount -t cifs -o username=*USERNAME*,password=*PASSWORD* //*DC_IP*/SYSVOL /smbclient `
- Then just copy it recursively to wherever you want it to be, or zip it. 
- Don't forget to grep through it for "cpassword" to find those good good local admin passwords.
        - Recursive grep throug hthe whole folder:
        ` grep -r "cpassword" . `

## TMUX
- Capture buffer:
` : capture-pane -S -10000 `
- Save captured buffer:
` : save-buffer filename.txt `

## nmap
- List range and do not scan:
` nmap -sL -n 192.168.0.1/24 `

## SSH over HTTP
Useful if outbound SSH traffic is forbidden.
- Prereqs: Cloud server and client have "httptunnel" installed, or can install it.
- On server:
    ` hts -F ${ForwardToIP}:${ForwardToPort} ${IncomingPort} `
        - Example - receive on 443, send to google DNS on port 22: ` hts -F 8.8.8.8:22 443 `
- On client:
    ` htc -F ${LocalPort} -P ${ProxyAddr}:${ProxyPort} ${TargetIP}:${TargetPort} `
    - Example - forward local port 2222 to 10.10.1.5 port 443, with a final destination of google dns port 22: ` htc -F 2222 -P 10.10.1.5:443 8.8.8.8:22 `

